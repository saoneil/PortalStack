<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>client view</title>
  <link rel="stylesheet" href="css/landing.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>
  <div class="header-image-container">
    <img src="/images/PMA_Score_8.png" alt="render_error" class="header-image">
  </div>

  <!-- <h2 class="heading">please select a scoring system to continue:</h2> -->
  <p>select a scoring system:</p>
  <table id="grid"></table>

  <div id="qrOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;">
    <div id="qrContainer" style="background:#fff; padding:20px; border-radius:8px; position:relative;">
      <button onclick="document.getElementById('qrOverlay').style.display='none'" style="position:absolute; top:10px; right:10px;">âœ•</button>
      <!-- <div id="qrCode"></div> -->
      <div id="qrCode" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>
    </div>
  </div>

  
  <form action="/logout" method="get" class="logout-form">
    <button class="btn block-cube block-cube-hover" type="submit">
      <div class="bg-top"><div class="bg-inner"></div></div>
      <div class="bg-right"><div class="bg-inner"></div></div>
      <div class="bg"><div class="bg-inner"></div></div>
      <div class="text">logout</div>
    </button>
  </form>


  <script>
    fetch('/api/grid-data')
      .then(res => res.json())
      .then(data => {
        const table = document.getElementById('grid');
        if (data.length === 0) {
          table.innerHTML = '<tr><td>No data</td></tr>';
          return;
        }

        const headers = Object.keys(data[0]);
        const headerRow = document.createElement('tr');
        headers.forEach(h => {
          const th = document.createElement('th');
          th.textContent = h;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        data.forEach(row => {
          const tr = document.createElement('tr');
          headers.forEach(h => {
            const td = document.createElement('td');
            if (h === 'App URL') {
              const a = document.createElement('a');
              a.href = row[h];
              a.textContent = row['App Instance Name'] || 'app link';
              a.target = '_blank';
              td.appendChild(a);
            } else if (h === 'Extra Links') {
              const linkField = row[h];
              if (linkField) {
                const links = linkField.split(',').map(l => l.trim()).filter(l => l);
                if (links.length > 0) {
                  const btn = document.createElement('button');
                  btn.textContent = 'Show QRs';
                  btn.onclick = () => {
                    const qrCodeDiv = document.getElementById('qrCode');
                    qrCodeDiv.innerHTML = ''; // Clear previous

                    links.forEach((link, idx) => {
                      const container = document.createElement('div');
                      container.style.display = 'flex';
                      container.style.flexDirection = 'column';
                      container.style.alignItems = 'center';
                      container.style.margin = '30px';

                      const label = document.createElement('div');
                      label.textContent = `Umpire ${idx + 1}`;
                      label.style.marginBottom = '10px';
                      label.style.fontWeight = 'bold';
                      label.style.color = 'black';
                      label.style.fontSize = '30px';

                      const qrDiv = document.createElement('div');
                      new QRCode(qrDiv, {
                        text: link,
                        width: 225,
                        height: 225,
                        correctLevel: QRCode.CorrectLevel.L
                      });

                      container.appendChild(label);
                      container.appendChild(qrDiv);
                      qrCodeDiv.appendChild(container);
                    });
                    document.getElementById('qrOverlay').style.display = 'flex';
                  };
                  td.appendChild(btn);
                }
              }
            }
            else {
              td.textContent = row[h];
            }

            tr.appendChild(td);
          });
          table.appendChild(tr);
        });
      });
  </script>

</body>
</html>
